<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaPet: Smart & Cute PYQ Quest</title>
    <style>
        :root { --primary: #4a69bd; --accent: #78e08f; --bg: #fdfaf6; --gold: #f6b93b; --pink: #ff9ff3; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .app-container { background: white; width: 100%; max-width: 450px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); overflow: hidden; border: 4px solid #eee; }
        .screen { padding: 25px; display: none; }
        .active { display: block; }

        /* Cute Mascot Stage */
        .header { background: linear-gradient(135deg, var(--primary), #6a89cc); color: white; padding: 30px 20px; text-align: center; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; }
        .pet-stage { position: relative; width: 180px; height: 180px; margin: 0 auto; display: flex; justify-content: center; align-items: center; font-size: 7rem; animation: bounce 2s infinite ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1.1); } }

        /* Accessory Layers */
        .acc { position: absolute; pointer-events: none; transition: all 0.3s; }
        .acc-aura { font-size: 9rem; z-index: 1; animation: pulse 1.5s infinite alternate; color: var(--gold); }
        .acc-body { font-size: 4.5rem; bottom: 5px; z-index: 3; }
        .acc-eyes { font-size: 3rem; top: 50px; z-index: 4; }
        .acc-head { font-size: 3.5rem; top: -10px; z-index: 5; }
        .acc-hand { font-size: 3rem; right: -10px; bottom: 30px; z-index: 4; }

        .mood-container { width: 60%; background: rgba(255,255,255,0.3); height: 10px; border-radius: 5px; margin: 15px auto; overflow: hidden; }
        #moodBar { width: 100%; height: 100%; background: var(--accent); transition: width 0.5s; }

        .stats { display: flex; justify-content: space-around; background: #f1f2f6; padding: 12px; font-weight: bold; color: var(--primary); }
        .mission-card { background: #f0f7ff; border-radius: 20px; padding: 20px; margin: 20px 0; border: 2px dashed var(--primary); color: #2f3542; min-height: 80px; display: flex; align-items: center; justify-content: center; text-align: center; }
        
        input { width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 15px; margin-bottom: 15px; font-size: 1.1rem; text-align: center; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; margin-bottom: 12px; font-size: 1rem; transition: 0.2s; }
        .btn-check { background: var(--primary); box-shadow: 0 4px 0 #3c56a4; }
        .btn-mcq { background: white; color: var(--primary); border: 2px solid var(--primary); text-align: center; line-height: 1.2; }
        .btn-mcq:hover { background: var(--primary); color: white; }
        .btn-shop { background: var(--pink); }

        .shop-grid { display: grid; gap: 10px; max-height: 300px; overflow-y: auto; }
        .owned { background: #dcdde1 !important; color: #7f8c8d !important; }
        sub, sup { font-size: 0.7em; }
    </style>
</head>
<body>

<div class="app-container">
    <div id="screen-login" class="screen active">
        <h2 style="text-align:center; color: var(--primary);">Adopt Your Mascot ‚ú®</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
            <div style="font-size:3.5rem; cursor:pointer; text-align:center;" onclick="savePet('üê±')">üê±</div>
            <div style="font-size:3.5rem; cursor:pointer; text-align:center;" onclick="savePet('üê∂')">üê∂</div>
            <div style="font-size:3.5rem; cursor:pointer; text-align:center;" onclick="savePet('ü¶ä')">ü¶ä</div>
            <div style="font-size:3.5rem; cursor:pointer; text-align:center;" onclick="savePet('üêº')">üêº</div>
            <div style="font-size:3.5rem; cursor:pointer; text-align:center;" onclick="savePet('üê®')">üê®</div>
            <div style="font-size:3.5rem; cursor:pointer; text-align:center;" onclick="savePet('üê∞')">üê∞</div>
        </div>
    </div>

    <div id="screen-lab" class="screen">
        <div class="header">
            <div class="pet-stage">
                <div id="auraLayer" class="acc acc-aura"></div>
                <div id="bodyLayer" class="acc acc-body"></div>
                <div id="mainPet">üê±</div>
                <div id="eyeLayer" class="acc acc-eyes"></div>
                <div id="headLayer" class="acc acc-head"></div>
                <div id="handLayer" class="acc acc-hand"></div>
            </div>
            <div class="mood-container"><div id="moodBar"></div></div>
            <b id="rankText">INTERN</b>
        </div>
        <div class="stats">
            <span>‚ú® <span id="score">0</span> pts</span>
            <span>üß™ Lvl <span id="levelNum">1</span></span>
        </div>
        <div class="content">
            <div id="missionText" class="mission-card">Let's solve some chemistry!</div>
            <div id="calcInputArea">
                <input type="number" id="userValue" placeholder="Enter number...">
                <button class="btn btn-check" onclick="checkAnswer()">Verify Result</button>
            </div>
            <div id="mcqOptions" style="display: none; flex-direction: column; gap: 8px;"></div>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn" style="background:var(--accent)" onclick="showScreen('screen-feed')">Feed üçé</button>
                <button class="btn btn-shop" onclick="showScreen('screen-shop')">Shop üõí</button>
            </div>
            <div id="feedback" style="text-align:center; font-weight:bold; margin-top: 5px;"></div>
        </div>
    </div>

    <div id="screen-shop" class="screen">
        <h2 style="color:var(--pink)">Boutique üéÄ</h2>
        <div id="shopList" class="shop-grid"></div>
        <button class="btn" style="background:var(--primary); margin-top:15px;" onclick="showScreen('screen-lab')">Back to Lab</button>
    </div>

    <div id="screen-feed" class="screen">
        <h2>Snack Time! üç¨</h2>
        <button class="btn" style="background:var(--accent)" onclick="feedPet(30, 40)">Sugar Cube (-40 pts)</button>
        <button class="btn" style="background:var(--primary)" onclick="showScreen('screen-lab')">Back</button>
    </div>
</div>

<script>
    const items = [
        { id: 'coat', label: 'Mini Lab Coat', icon: 'ü•º', cost: 50, slot: 'body' },
        { id: 'goggles', label: 'Round Goggles', icon: 'ü•Ω', cost: 80, slot: 'eyes' },
        { id: 'shield', label: 'Face Shield', icon: 'üõ°Ô∏è', cost: 120, slot: 'eyes' },
        { id: 'flask', label: 'Tiny Flask', icon: 'üß™', cost: 150, slot: 'hand' },
        { id: 'crown', label: 'Golden Tiara', icon: 'üëë', cost: 250, slot: 'head' },
        { id: 'sparkles', label: 'Magic Dust', icon: '‚ú®', cost: 350, slot: 'aura' },
        { id: 'gown', label: 'Graduation Cap', icon: 'üéì', cost: 450, slot: 'head' }
    ];

    const missions = [
        // LVL 1
        { lvl: 1, isMCQ: true, text: "Geometry of SO<sub>2</sub>?", options: ["Linear", "Bent", "T-shaped", "Trigonal Planar"], correct: "Bent" },
        { lvl: 1, isMCQ: true, text: "Geometry of BF<sub>3</sub>?", options: ["Trigonal Planar", "Tetrahedral", "Bent", "Octahedral"], correct: "Trigonal Planar" },
        { lvl: 1, isMCQ: true, text: "Electron geometry of H<sub>2</sub>O?", options: ["Linear", "Tetrahedral", "Bent", "Trigonal Planar"], correct: "Tetrahedral" },
        { lvl: 1, text: "Grams of NaOH (MW:40) for 1.5L of 0.1M?", calc: () => 6.00 },
        { lvl: 1, text: "Grams of NaCl (MW:58.4) for 500mL of 0.2M?", calc: () => 5.84 },
        { lvl: 1, isMCQ: true, text: "Valence electrons in Phosphorus?", options: ["3", "4", "5", "6"], correct: "5" },
        { lvl: 1, isMCQ: true, text: "End-to-end orbital overlap forms which bond?", options: ["Sigma (œÉ)", "Pi (œÄ)", "Delta (Œ¥)", "Ionic"], correct: "Sigma (œÉ)" },
        { lvl: 1, text: "Moles in 2L of 0.5M Glucose?", calc: () => 1.00 },
        { lvl: 1, isMCQ: true, text: "Bond forms when attraction is ___ repulsion.", options: ["<", "=", ">", "Zero"], correct: ">" },
        { lvl: 1, text: "Molarity of 10g NaOH (MW:40) in 250mL?", calc: () => 1.00 },

        // LVL 2
        { lvl: 2, isMCQ: true, text: "IUPAC Name for Ni(CO)<sub>4</sub>?", options: ["Nickel carbonyl", "Tetracarbonylnickel(0)", "Nickel(IV) carbonyl", "Tetra(carbon)nickel"], correct: "Tetracarbonylnickel(0)" },
        { lvl: 2, isMCQ: true, text: "K<sub>sp</sub> expression for Ag<sub>2</sub>SO<sub>4</sub>?", options: ["[Ag<sup>+</sup>][SO<sub>4</sub><sup>2-</sup>]", "[Ag<sup>+</sup>]<sup>2</sup>[SO<sub>4</sub><sup>2-</sup>]", "[Ag<sup>+</sup>][SO<sub>4</sub><sup>2-</sup>]<sup>2</sup>", "[Ag<sup>2+</sup>][SO<sub>4</sub><sup>2-</sup>]"], correct: "[Ag<sup>+</sup>]<sup>2</sup>[SO<sub>4</sub><sup>2-</sup>]" },
        { lvl: 2, isMCQ: true, text: "Hybridisation of P in PCl<sub>5</sub>?", options: ["sp<sup>3</sup>", "sp<sup>3</sup>d", "sp<sup>3</sup>d<sup>2</sup>", "dsp<sup>2</sup>"], correct: "sp<sup>3</sup>d" },
        { lvl: 2, isMCQ: true, text: "Best indicator for Acetic Acid vs KOH?", options: ["Methyl Orange", "Phenolphthalein", "Litmus", "Potassium Chromate"], correct: "Phenolphthalein" },
        { lvl: 2, text: "Grams Lidocaine for 200mL of 2% (w/v)?", calc: () => 4.00 },
        { lvl: 2, isMCQ: true, text: "Hybridisation of S in SF<sub>6</sub>?", options: ["sp<sup>3</sup>d", "sp<sup>3</sup>d<sup>2</sup>", "sp<sup>3</sup>", "sp<sup>2</sup>"], correct: "sp<sup>3</sup>d<sup>2</sup>" },
        { lvl: 2, isMCQ: true, text: "K<sub>sp</sub> for PbCl<sub>2</sub>?", options: ["[Pb<sup>2+</sup>][Cl<sup>-</sup>]", "[Pb<sup>2+</sup>][Cl<sup>-</sup>]<sup>2</sup>", "[Pb<sup>2+</sup>]<sup>2</sup>[Cl<sup>-</sup>]", "[Pb][Cl]<sub>2</sub>"], correct: "[Pb<sup>2+</sup>][Cl<sup>-</sup>]<sup>2</sup>" },
        { lvl: 2, text: "mL Ethanol for 500mL of 70% (v/v)?", calc: () => 350.00 },
        { lvl: 2, isMCQ: true, text: "IUPAC for [Cu(NH<sub>3</sub>)<sub>4</sub>]<sup>2+</sup>?", options: ["Copper ammonium", "Tetraamminecopper(II)", "Cupric ammonia", "Tetraaminocopper(0)"], correct: "Tetraamminecopper(II)" },
        { lvl: 2, text: "Grams drug for 100g of 5% (w/w) ointment?", calc: () => 5.00 },

        // LVL 3
        { lvl: 3, isMCQ: true, text: "Bond order for O<sub>2</sub><sup>+</sup>?", options: ["1.5", "2.0", "2.5", "3.0"], correct: "2.5" },
        { lvl: 3, isMCQ: true, text: "Bond order for N<sub>2</sub>?", options: ["1.5", "2.0", "2.5", "3.0"], correct: "3.0" },
        { lvl: 3, text: "Buffer: [A<sup>-</sup>]=0.5, [HA]=0.05, pK<sub>a</sub>=3.8. pH?", calc: () => 4.80 },
        { lvl: 3, text: "Target pH: 5.2, pK<sub>a</sub>: 4.2. Ratio [A<sup>-</sup>]/[HA]?", calc: () => 10.00 },
        { lvl: 3, isMCQ: true, text: "Which molecule is paramagnetic?", options: ["N<sub>2</sub>", "O<sub>2</sub>", "F<sub>2</sub>", "H<sub>2</sub>"], correct: "O<sub>2</sub>" },
        { lvl: 3, isMCQ: true, text: "In MO theory, œÄ*<sub>2p</sub> is filled last for:", options: ["N<sub>2</sub>", "O<sub>2</sub>", "F<sub>2</sub>", "Li<sub>2</sub>"], correct: "O<sub>2</sub>" },
        { lvl: 3, text: "pH of [HA]=0.2M, [A<sup>-</sup>]=0.02M, pK<sub>a</sub>=9.2?", calc: () => 8.20 },
        { lvl: 3, text: "Aspirin (pK<sub>a</sub> 3.5), pH 4.5. Ratio?", calc: () => 10.00 },
        { lvl: 3, isMCQ: true, text: "If [A<sup>-</sup>] = [HA], then pH equals:", options: ["7.0", "pK<sub>a</sub>", "pK<sub>b</sub>", "1.0"], correct: "pK<sub>a</sub>" },
        { lvl: 3, text: "Find pH: [A<sup>-</sup>]=0.25, [HA]=0.25, pK<sub>a</sub>=7.2.", calc: () => 7.20 }
    ];

    let state = JSON.parse(localStorage.getItem('pharmaCutePro')) || { score: 0, mood: 100, pet: null, ownedItems: [] };
    let usedQuestions = [];
    let currentTask = {};

    function savePet(pet) { state.pet = pet; saveAndSync(); showScreen('screen-lab'); }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'screen-lab') nextMission();
        if(id === 'screen-shop') renderShop();
    }

    function nextMission() {
        document.getElementById('feedback').innerText = '';
        document.getElementById('userValue').value = '';
        let pool = missions.filter(m => (state.score < 100 ? m.lvl === 1 : state.score < 300 ? m.lvl === 2 : m.lvl === 3));
        let available = pool.filter(q => !usedQuestions.includes(q.text));
        if (available.length === 0) {
            usedQuestions = usedQuestions.filter(txt => !pool.map(p => p.text).includes(txt));
            available = pool;
        }
        currentTask = available[Math.floor(Math.random() * available.length)];
        usedQuestions.push(currentTask.text);
        document.getElementById('missionText').innerHTML = currentTask.text;
        document.getElementById('levelNum').innerText = currentTask.lvl;

        if (currentTask.isMCQ) {
            document.getElementById('calcInputArea').style.display = 'none';
            const mcq = document.getElementById('mcqOptions');
            mcq.style.display = 'flex'; mcq.innerHTML = '';
            currentTask.options.forEach(opt => {
                const b = document.createElement('button');
                b.className = "btn btn-mcq"; b.innerHTML = opt;
                b.onclick = () => processResult(opt === currentTask.correct);
                mcq.appendChild(b);
            });
        } else {
            document.getElementById('calcInputArea').style.display = 'block';
            document.getElementById('mcqOptions').style.display = 'none';
        }
    }

    function checkAnswer() {
        const val = parseFloat(document.getElementById('userValue').value);
        processResult(Math.abs(val - currentTask.calc()) < 0.1);
    }

    function processResult(isCorrect) {
        const fb = document.getElementById('feedback');
        if (isCorrect) {
            state.score += 25; state.mood = Math.min(100, state.mood + 10);
            fb.innerText = "‚ú® Correct! +25 Points!"; fb.style.color = "var(--accent)";
            setTimeout(nextMission, 1000);
        } else {
            state.score = Math.max(0, state.score - 5); state.mood = Math.max(0, state.mood - 15);
            fb.innerText = "Oops! Try again."; fb.style.color = "red";
        }
        saveAndSync();
    }

    function renderShop() {
        const list = document.getElementById('shopList'); list.innerHTML = '';
        items.forEach(item => {
            const owned = state.ownedItems.includes(item.id);
            const b = document.createElement('button');
            b.className = `btn ${owned ? 'owned' : ''}`;
            b.innerText = `${item.label} (${item.cost} pts)`;
            if(!owned) b.onclick = () => {
                if(state.score >= item.cost) {
                    state.score -= item.cost; state.ownedItems.push(item.id);
                    saveAndSync(); renderShop();
                } else alert("Solve more puzzles to earn points!");
            };
            list.appendChild(b);
        });
    }

    function feedPet(boost, cost) {
        if(state.score >= cost) { state.score -= cost; state.mood = Math.min(100, state.mood + boost); saveAndSync(); showScreen('screen-lab'); }
    }

    function saveAndSync() {
        localStorage.setItem('pharmaCutePro', JSON.stringify(state));
        document.getElementById('score').innerText = state.score;
        document.getElementById('moodBar').style.width = state.mood + "%";
        document.getElementById('mainPet').innerText = state.mood < 40 ? 'üòø' : state.pet;
        ['auraLayer','bodyLayer','eyeLayer','headLayer','handLayer'].forEach(l => document.getElementById(l).innerText = '');
        state.ownedItems.forEach(id => {
            const itm = items.find(i => i.id === id);
            if(itm) document.getElementById(`${itm.slot}Layer`).innerText = itm.icon;
        });
        let r = "INTERN";
        if(state.score >= 100) r = "JUNIOR RESEARCHER";
        if(state.score >= 300) r = "SENIOR PHARMACIST";
        document.getElementById('rankText').innerText = r;
    }
    if(state.pet) { showScreen('screen-lab'); saveAndSync(); }
</script>
</body>
</html>
